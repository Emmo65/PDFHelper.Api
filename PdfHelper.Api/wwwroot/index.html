<!doctype html>
<html lang="de" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PDF Helper</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <!-- Animiertes Logo -->
      <svg class="logo" viewBox="0 0 120 120" width="48" height="48" aria-hidden="true">
  <defs>
    <linearGradient id="g1" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" stop-color="#6ae2ff"/>
      <stop offset="50%" stop-color="#8f7aff"/>
      <stop offset="100%" stop-color="#00ffa3"/>
    </linearGradient>
    <filter id="glow">
      <feGaussianBlur stdDeviation="3.5" result="coloredBlur"/>
      <feMerge>
        <feMergeNode in="coloredBlur"/>
        <feMergeNode in="SourceGraphic"/>
      </feMerge>
    </filter>
  </defs>
  <!-- Wichtig: fill='none', damit kein schwarzer Vollkreis erscheint -->
  <circle cx="60" cy="60" r="44" fill="none" stroke="rgba(255,255,255,.18)" stroke-width="10"/>
  <g class="spinner" filter="url(#glow)">
    <path d="M60 12 A48 48 0 0 1 108 60" stroke="url(#g1)" stroke-width="10" fill="none" stroke-linecap="round"/>
  </g>
</svg>

      <h1>PDF Helper</h1>
    </div>

    <button id="themeToggle" class="btn ghost" aria-label="Theme umschalten">ðŸŒ—</button>
  </header>

  <main class="wrap">
    <div class="grid">

      <!-- MERGE -->
      <section class="card" data-op="merge">
        <div class="badge">Merge</div>
        <h2>PDFs zusammenfÃ¼hren</h2>
        <div class="row">
          <div class="dropzone" data-target="mergeFiles">
            <span>PDFs hierher ziehen<br><small>oder klicken, um Dateien zu wÃ¤hlen</small></span>
            <input type="file" id="mergeFiles" multiple accept="application/pdf">
          </div>
          <button class="btn primary" onclick="merge()">ZusammenfÃ¼hren</button>
        </div>
        <p class="muted">Mindestens 2 PDFs auswÃ¤hlen.</p>
      </section>

      <!-- SPLIT -->
      <section class="card" data-op="split">
        <div class="badge">Split</div>
        <h2>PDF aufteilen</h2>
        <div class="row">
          <div class="dropzone" data-target="splitFile">
            <span>PDF hierher ziehen<br><small>oder klicken</small></span>
            <input type="file" id="splitFile" accept="application/pdf">
          </div>
          <input type="text" id="splitRanges" class="input" placeholder="z. B. 1-3,5,8-end">
          <button class="btn primary" onclick="split()">Aufteilen</button>
        </div>
        <p class="muted">Bereiche kommasepariert. <code>end</code> = letzte Seite.</p>
      </section>

      <!-- ROTATE -->
      <section class="card" data-op="rotate">
        <div class="badge">Rotate</div>
        <h2>Seiten drehen</h2>
        <div class="row">
          <div class="dropzone" data-target="rotFile">
            <span>PDF hierher ziehen<br><small>oder klicken</small></span>
            <input type="file" id="rotFile" accept="application/pdf">
          </div>
          <input type="text" id="rotPages" class="input" placeholder="z. B. 2,4-5">
          <select id="rotAngle" class="input">
            <option value="90">90Â°</option>
            <option value="180">180Â°</option>
            <option value="270">270Â°</option>
          </select>
          <button class="btn primary" onclick="rotate()">Drehen</button>
        </div>
      </section>

      <!-- COMPRESS -->
      <section class="card" data-op="compress">
        <div class="badge">Compress</div>
        <h2>PDF komprimieren</h2>
        <div class="row">
          <div class="dropzone" data-target="cmpFile">
            <span>PDF hierher ziehen<br><small>oder klicken</small></span>
            <input type="file" id="cmpFile" accept="application/pdf">
          </div>
          <select id="cmpLevel" class="input">
            <option value="standard">standard (/ebook)</option>
            <option value="low">low (/screen)</option>
            <option value="high">high (/prepress)</option>
          </select>
          <button class="btn primary" onclick="compress()">Komprimieren</button>
        </div>
        <p class="muted">BenÃ¶tigt Ghostscript â€“ sonst erscheint ein Hinweis.</p>
      </section>

    </div>
  </main>

  <div id="toast" class="toast">Download gestartetâ€¦</div>

<script>
/* ---------- Theme Toggle ---------- */
const html = document.documentElement;
const saved = localStorage.getItem('pdfhelper-theme');
if(saved){ html.setAttribute('data-theme', saved); }
document.getElementById('themeToggle').addEventListener('click', () => {
  const next = html.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
  html.setAttribute('data-theme', next);
  localStorage.setItem('pdfhelper-theme', next);
});

/* ---------- Drag & Drop ---------- */
function wireDropzones(){
  document.querySelectorAll('.dropzone').forEach(zone => {
    const input = zone.querySelector('input[type="file"]');
    const span  = zone.querySelector('span');

    zone.addEventListener('click', () => input.click());
    zone.addEventListener('dragover', e => { e.preventDefault(); zone.classList.add('drag'); });
    zone.addEventListener('dragleave', () => zone.classList.remove('drag'));
    zone.addEventListener('drop', e => {
      e.preventDefault(); zone.classList.remove('drag');
      const dt = new DataTransfer();
      [...e.dataTransfer.files].forEach(f => dt.items.add(f));
      input.files = dt.files;
      span.textContent = input.multiple ? `${input.files.length} Datei(en) gewÃ¤hlt` : (input.files[0]?.name || '1 Datei gewÃ¤hlt');
    });
    input.addEventListener('change', () => {
      span.textContent = input.multiple ? `${input.files.length} Datei(en) gewÃ¤hlt` : (input.files[0]?.name || '1 Datei gewÃ¤hlt');
    });
  });
}
wireDropzones();

/* ---------- Toast ---------- */
function showToast(msg){
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(()=> t.classList.remove('show'), 1800);
}

/* ---------- Download Helper ---------- */
async function downloadFromResponse(res, filename){
  if(!res.ok){
    try{
      const err = await res.json();
      alert(err.message || "Fehler");
    }catch{ alert("Fehler"); }
    return;
  }
  const blob = await res.blob();
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = filename; a.click();
  URL.revokeObjectURL(url);
  showToast('Download gestartet: ' + filename);
}

/* ---------- API Calls ---------- */
async function merge(){
  const inp = document.getElementById('mergeFiles');
  const fd = new FormData();
  if(!inp.files?.length || inp.files.length < 2){ alert('Bitte mindestens 2 PDFs wÃ¤hlen.'); return; }
  [...inp.files].forEach(f => fd.append('files', f));
  const res = await fetch('/api/merge', { method:'POST', body: fd });
  await downloadFromResponse(res, 'merged.pdf');
}

async function split(){
  const file = document.getElementById('splitFile').files[0];
  const ranges = document.getElementById('splitRanges').value.trim();
  if(!file){ alert('Bitte ein PDF wÃ¤hlen.'); return; }
  if(!ranges){ alert('Bitte Bereiche angeben, z. B. 1-3,5,end'); return; }
  const fd = new FormData();
  fd.append('file', file);
  const res = await fetch(`/api/split?ranges=${encodeURIComponent(ranges)}`, { method:'POST', body: fd });
  await downloadFromResponse(res, 'parts.zip');
}

async function rotate(){
  const file = document.getElementById('rotFile').files[0];
  const pages = document.getElementById('rotPages').value.trim();
  const angle = document.getElementById('rotAngle').value;
  if(!file){ alert('Bitte ein PDF wÃ¤hlen.'); return; }
  if(!pages){ alert('Bitte Seiten angeben, z. B. 2,4-5'); return; }
  const fd = new FormData();
  fd.append('file', file);
  const res = await fetch(`/api/rotate?pages=${encodeURIComponent(pages)}&angle=${angle}`, { method:'POST', body: fd });
  await downloadFromResponse(res, 'rotated.pdf');
}

async function compress(){
  const file = document.getElementById('cmpFile').files[0];
  const level = document.getElementById('cmpLevel').value;
  if(!file){ alert('Bitte ein PDF wÃ¤hlen.'); return; }
  const fd = new FormData();
  fd.append('file', file);
  const res = await fetch(`/api/compress?level=${level}`, { method:'POST', body: fd });
  await downloadFromResponse(res, 'compressed.pdf');
}
</script>
</body>
</html>
